---
title: "HW 5"
author: "Jake Vettoretti"
date: "2025-11-06"
output: github_document
---

```{r}
library(broom)
library(tidyverse)
set.seed(1)
```


## Problem 1


```{r}
# Define simulation function
bday_sim = function(n_room) {
  birthdays = sample(1:365, n_room, replace = TRUE)
  repeated_bday = length(unique(birthdays)) < n_room
  return(repeated_bday)
}

# Run simulation for group sizes 2â€“50, with 10,000 iterations each
bday_sim_results = 
  expand_grid(
    bdays = 2:50,
    iter = 1:10000
  ) |> 
  mutate(
    result = map_lgl(bdays, bday_sim) #returns logical vector
  ) |> 
  group_by(
    bdays
  ) |> 
  summarize(
    prob_repeat=mean(result)
  )

bday_sim_results

# Plot results
bday_sim_results |> 
  ggplot(aes(x = bdays, y = prob_repeat)) +
  geom_point() +
  geom_line() +
  labs(
    x = "Group size (n)",
    y = "Probability of shared birthday",
    title = "Probability that at least two people share a birthday"
  ) +
  theme_minimal()
```

Comments:
The plot shows that the probability that at least two people share a birthday increases quickly as the number of people in the room grows. When only a few people are present the chance of a shared birthday is very small but the probability rises sharply as the group becomes larger. Around twenty three people the probability reaches about fifty percent and by forty people it is close to one hundred percent. This finding illustrates the birthday paradox where even small groups have a surprisingly high chance of sharing a birthday because the number of possible pairs increases rapidly with group size.

## Question 2

Part 1, mu = 0

```{r}
#Setting the design elements
n = 30        # sample size
sigma = 5     # population SD
mu = 0        # true mean
n_sims = 5000 # number of simulated datasets

#Part 1, simulate 5000 datasets and test H0: mu=0
sim_mu0 =
  tibble(iter = 1:n_sims) |>
  mutate(
    results = map(iter, \(i) {
      tibble(x = rnorm(n, mean = mu, sd = sigma)) |>
        summarize(test = list(tidy(t.test(x, mu = 0)))) |>
        unnest(cols = c(test)) |>
        select(estimate, p.value)
    })
  ) |>
  unnest(cols = c(results))


#Part 1, checking model

sim_mu0 |>
  summarize(
    avg_mu_hat = mean(estimate),
    sd_mu_hat  = sd(estimate),
    type1error_rate = mean(p.value < 0.05)
  )
```

Part 2, mu = 1:6
```{r}
n = 30
sigma = 5
mu_values = 1:6
n_sims = 5000

# Repeat simulation for each Î¼
sim_results =
  map_df(mu_values, \(m) {
    tibble(iter = 1:n_sims) |>
      mutate(
        results = map(iter, \(i) {
          tibble(x = rnorm(n, mean = m, sd = sigma)) |>
            summarize(test = list(tidy(t.test(x, mu = 0)))) |>
            unnest(cols = c(test)) |>
            select(estimate, p.value)
        })
      ) |>
      unnest(cols = c(results)) |>
      mutate(mu = m)
  })

# Check one example
sim_results |> 
  group_by(mu) |> 
  summarize(power = mean(p.value < 0.05))
```

Plotting power vs mu
```{r}
power_df =
  sim_results |>
  group_by(mu) |>
  summarize(
    power = mean(p.value < 0.05),
    .groups = "drop"
  )

power_df |>
  ggplot(aes(x = mu, y = power)) +
  geom_point(size = 3) +
  geom_line(linewidth = 1) +
  scale_y_continuous(limits = c(0, 1), labels = scales::percent_format()) +
  labs(
    title = "Empirical Power vs True Mean (Î¼)",
    x = "True Mean (Î¼)",
    y = "Power (Proportion Rejecting Hâ‚€)"
  ) +
  theme_minimal(base_size = 14)
```

Describe the association between effect size and power:


Make a plot showing the average estimate of ðœ‡Ì‚ on the y axis and the true value of ðœ‡on the x axis with overlay on the first the average estimate of ðœ‡Ì‚ only in samples for which the null was rejected on the y axis and the true value of ðœ‡on the x axis.

```{r}
bias_df =
  sim_results |>
  group_by(mu) |>
  summarize(
    mean_est_all = mean(estimate),
    mean_est_sig = mean(estimate[p.value < 0.05]),
    .groups = "drop"
  )

bias_df

bias_df |>
  ggplot(aes(x = mu)) +
  geom_line(aes(y = mean_est_all, color = "All tests"), linewidth = 1) +
  geom_point(aes(y = mean_est_all, color = "All tests"), size = 2) +
  geom_line(aes(y = mean_est_sig, color = "Rejected Hâ‚€ only"), linewidth = 1) +
  geom_point(aes(y = mean_est_sig, color = "Rejected Hâ‚€ only"), size = 2) +
  labs(
    title = "Average Estimated Mean (Î¼Ì‚) vs True Mean (Î¼)",
    x = "True Mean (Î¼)",
    y = "Average Estimate (Î¼Ì‚)",
    color = ""
  ) +
  theme_minimal(base_size = 14)
```




